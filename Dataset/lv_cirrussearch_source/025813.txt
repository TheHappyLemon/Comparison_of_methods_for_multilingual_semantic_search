ICMP (angļu: Internet Control Message Protocol - "interneta vadības ziņojumu protokols") - tīkla slāņa protokols, kas ietilpst TCP/IP stekā. Šo protokolu izmanto, lai informētu par kļūdām un citiem gadījumiem, kas radušies datu pārraides laikā. Tāpat ICMP izmanto, lai sūtītu testu paketes un citus informatīvos ziņojumus. ICMP ir definēts RFC 792 (ar papildinājumiem RFC 950). Tas ir IP protokola neatņemama sastāvdaļa. ICMP versija IPv4 tiek saukta par ICMPv4, IPv6 ir ekvivalents protokols - ICMPv6. ICMP ziņojumi tiek inkapsulēti IP datagrammās, bet tas, tāpat kā UDP, negarantē mērķa sasniegšanu. Daudzi tīkla diagnosticēšanas rīki izmanto ICMP. Piemēram, komanda traceroute sūta īpaši sagatavotas UDP datagrammas un gaida ICMP atbildes "Time to live exceeded in transit" vai "Destination unreachable". Savukārt rīks ping izmanto ICMP "Echo" un "Echo reply" paziņojumus. Tips (Type) - 8 bitu lauks, kurā norādīts ICMP paziņojuma tips (sk. zemāk sarakstu); Kods (Code) - 8 bitu lauks, kurā norāda vienu no vairākām iespējamām funkcijām šim tipam; Kontrolsumma (Checksum) - 16 biti, paketes kontrolsumma; Specifiskie tipa dati (Type-Specific Data) - papildu dati, atkarīgi no tipa un koda. 0 - Echo Reply 1 - Rezervēts 2 - Rezervēts 3 - Destination Unreachable 4 - Source Quench 5 - Redirect Message 6 - Alternate Host Address 7 - Rezervēts 8 - Echo Request 9 - Router Advertisement 10 - Router Solicitation 11 - Time Exceeded 12 - Parameter Problem 13 - Timestamp 14 - Timestamp Reply 15 - Information Request 16 - Information Reply 17 - Address Mask Request 18 - Address Mask Reply 19 - Rezervēts drošībai 20-29 - Rezervēti eksperimentiem 30 - Traceroute 31 - Datagram Conversion Error 32 - Mobile Host Redirect 33 - IPv6 Where-Are-You 34 - IPv6 Here-I-Am 35 - Mobile Registration Request 36 - Mobile Registration Reply 38 - Domain Name Reply 39 - SKIP Algorithm Discovery Protocol 40 - Photuris, Security failures 41 - ICMP eksperimentaliem protokoliem, piem., Seamoby [RFC4065] 42-255 - Rezervēti Kontroles ziņojumi tiek identificēti pēc to vērtības tipa laukā. Koda lauks sniedz papildu informāciju par kontekstu. Daži kontroles ziņojumi ir novecojuši kopš protokols tika ieviests. Avota dzēšana pieprasa, lai sūtītājs samazinātu ziņojumu skaitu, kas tiek nosūtīti uz maršrutētāju vai resursdatoru. Šis ziņojums var tikt ģenerēts, ja maršrutētājam vai resursdatoram nav pietiekamas bufertelpas, lai apstrādātu pieprasījumu, vai arī, ja maršrutētājam vai resursdatoram buferis tuvojas ierobežojumam. Dati tiek nosūtīti ļoti ātri no resursdatora vai no vairākiem resursdatoriem vienlaikus uz noteiktu maršrutētāju tīklā. Lai gan maršrutētājam ir bufera iespējas, buferēšana ir ierobežota noteiktā diapazonā. Maršrutētājs nevar sarakstīt vairāk datu nekā ierobežotās bufertelpas ietilpība. Tādējādi, ja rinda tiek aizpildīta, ienākošie dati tiek atmesti, līdz rinda vairs nav pilna. Bet, tā kā tīkla slānī nav neviena apliecinājuma mehānisma, klients nezina, vai dati ir veiksmīgi sasnieguši galamērķi. Tādēļ tīkla slānim jāveic daži koriģējoši pasākumi, lai izvairītos no šādām situācijām. Šie pasākumi tiek saukti par avota dzēšanu. Avota dzēšanas mehānismā maršrutētājs redz, ka ienākošo datu pārraides ātrums ir daudz ātrāks nekā izejošo datu pārraides ātrums, un nosūta klientiem ICMP ziņojumu, informējot, ka ir jāpalēnina datu pārsūtīšanas ātrums vai jāgaida noteikts laiks, pirms mēģināt nosūtīt vairāk datu. Kad klients saņem šo ziņojumu, tas automātiski palēnina izejošo datu pārraides ātrumu vai gaida pietiekami daudz laika, kas maršrutētājam ļauj iztukšot rindu. Tādējādi avota dzēšanas ICMP ziņojums darbojas kā plūsmas vadība tīkla slānī. Tā kā pētījumi liecināja, ka “ICMP avota dzēšana [bija] neefektīvs (un negodīgs) pretlīdzeklis pārslodzes gadījumā”, RFC 1812 1995. gadā noraidīja maršrutētāju veikto avota dzēšanas ziņojumu izveidi. Turklāt RFC 6633 no 2012. gada ir noraidījusi ziņojumu par avotu dzēšanu nosūtīšanu un jebkāda veida reakciju uz tiem. Kur: Tipam jābūt iestatītam uz 4 Kodam jābūt iestatītam uz 0 Sūtītājs izmanto IP galveni un papildu datus, lai saskaņotu atbildi ar saistīto pieprasījumu Novirzīšanas pieprasījumu datu paketes tiek nosūtītas alternatīvā maršrutā. ICMP novirzīšana ir maršrutētāju mehānisms, kas nodrošina maršrutēšanas informāciju resursdatoriem. Ziņojums informē resursdatoru, lai atjauninātu maršruta informāciju (lai nosūtītu paketes alternatīvā maršrutā). Ja resursdators mēģina nosūtīt datus caur maršrutētāju (R1) un R1 nosūta datus ar citu maršrutētāju (R2) un tiešais ceļš no resursdatora uz R2 ir pieejams (tas ir, resursdators un R2 atrodas vienā Ethernet segmentā), tad R1 nosūtīs novirzīšanas ziņojumu, lai informētu resursdatoru, ka labākais maršruts galamērķim ir pa R2. Pēc tam resursdatoram jānosūta paketes adresātam tieši uz R2. Maršrutētājs joprojām nosūtīs sākotnējo datu failu uz paredzēto galamērķi. Tomēr, ja datagramma satur maršruta informāciju, šis ziņojums netiks nosūtīts pat tad, ja būs pieejams labāks maršruts. RFC 1122 nosaka, ka novirzītāji ir jāsūta tikai pa vārtejām, un tos nedrīkst sūtīt interneta saimnieki. Kur: Tipam jābūt iestatītam uz 5. Kods norāda novirzīšanas iemeslu. Var būt viens no šiem: IP adrese ir vārtejas 32 bitu adrese, uz kuru jānosūta novirzīšana. IP galvene un papildu dati ir iekļauti, lai ļautu resursdatoram saskaņot atbildi ar pieprasījumu, kas izraisīja novirzīšanas atbildi. Laiku, kas tiek pārsniegts, ģenerē vārteja, kas informē izbrāķētās datagrammas avotu, jo "dzīvošanas" laiks, kas vajadzīgs, lai sāktu darbu, sasniedz nulli. Ziņojums, kas pārsniegts laikā, var tikt nosūtīts arī no resursdatora, ja tā laikā neizdodas atkārtoti samontēt fragmentētu datagrammu. Pārsniegto laiku ziņojumi tiek izmantoti traceroute utilītā, lai noteiktu ceļa vārtejas starp diviem resursdatoriem. Kur: Tipam jābūt iestatītam uz 11 Kods norāda pārsniegtās laika ziņas iemeslu: IP galvene un pirmie 64 biti oriģinālajā vērtumā tiek izmantoti avota resursdatorā, lai saskaņotu pārsniegto laiku ar atmesto datagrammu. Augstākā līmeņa protokoliem, piemēram, UDP un TCP, 64 bitu lietderīgā slodze ietvers izmestās paketes avotu un mērķa portus. Laika zīmogu izmanto laika sinhronizācijai. Sākuma laika zīmogs tiek iestatīts uz laiku (milisekundēs kopš pusnakts), kad sūtītājs pēdējo reizi pieskārās paketei. Saņemšanas un nosūtīšanas laika zīmogi netiek izmantoti. Kur: Tipam jābūt iestatītam uz 13 Kodam jābūt iestatītam uz 0 Klients var izmantot identifikatoru un secības numuru, lai saskaņotu laika zīmoga atbildi ar laika zīmoga pieprasījumu. Izcelsmes laika zīmogs ir milisekunžu skaits kopš Universālā laika (UT) pusnakts. Ja UT atsauce nav pieejama, visnozīmīgāko bitu var iestatīt, lai norādītu nestandarta laika vērtību. Laika zīmoga atbilde atbild uz laika zīmoga ziņojumu. Tas sastāv no sākuma laika zīmoga, ko nosūta laika zīmoga sūtītājs, kā arī saņemšanas laika zīmogs, kas norāda laika zīmoga saņemšanas laiku, un nosūtīšanas laika zīmoga, kas norāda, kad laika zīmoga atbilde tika nosūtīta. Kur: Tipam jābūt iestatītam uz 14 Kodam jābūt iestatītam uz 0 Klients var izmantot identifikatoru un secības numuru, lai saskaņotu atbildi ar pieprasījumu, kas izraisīja atbildi. Izcelsmes laika zīmogs ir laiks, kad sūtītājs pēdējo reizi ir pieskāries ziņojumam pirms tā nosūtīšanas. Saņemšanas laika zīmogs ir laiks, kad atbalsis pirmoreiz pieskārās, to saņemot. Raidīšanas laika zīmogs ir laiks, kad atbalsis pēdējo reizi pieskārās ziņojumam, to nosūtot. Visi laika zīmogi kopš Universālā laika pusnakts ir milisekundēs. Ja laiks nav pieejams milisekundēs vai to nevar nodrošināt attiecībā uz pusnakti UT, tad jebkuru laiku var ievietot laika zīmogā, ja arī laika zīmoga augstas secības bits ir iestatīts, lai norādītu šo nestandarta vērtību. Adrešu maskas pieprasījumu parasti nosūta serveris maršrutētājam, lai iegūtu atbilstošu apakštīkla masku. Adresātiem uz šo ziņojumu ir jāatbild ar adreses maskas atbildes ziņojumu. Kur: Tipam jābūt iestatītam uz 17 Kodam jābūt iestatītam uz 0 Adreses masku var iestatīt uz 0 ICMP adrešu maskas pieprasījumu var izmantot kā daļu no izlūkošanas uzbrukuma, lai apkopotu informāciju par mērķa tīklu, tāpēc ICMP adrešu maskas atbilde pēc noklusējuma ir atspējota Cisco IOS. Adreses maskas atbildi izmanto, lai atbildētu uz adreses maskas pieprasījuma ziņojumu ar atbilstošu apakštīkla masku. Kur: Tipam jābūt iestatītam uz 18 Kodam jābūt iestatītam uz 0 Adreses maska jāiestata uz apakštīkla masku Galamērķi, kas nav sasniedzams, ģenerē resursdators vai tā ienākošā vārteja, lai informētu klientu, ka galamērķis kāda iemesla dēļ nav sasniedzams. Mērķa nesasniedzams ziņojums var tikt ģenerēts TCP vai UDP rezultātā. Nesasniedzamie TCP porti jo īpaši reaģē ar TCP RST (RST - (Reset) aiztaisa savienojumu piespiedu kārtā, šo lieto arī lai atteiktu savienojumu), nevis galamērķi, kas nav sasniedzams 3. tipam, kā varētu cerēt. Kļūda netiks ģenerēta, ja sākotnējam datu avotam ir multiraides galamērķa adrese. Šī ziņojuma iemesli var būt šādi: fiziskais savienojums ar resursdatoru nepastāv (attālums ir bezgalīgs); norādītais protokols vai ports nav aktīvs; datiem jābūt fragmentētiem, bet karodziņš 'nefragmentēt' ir ieslēgts. Kur: Tipa laukam (Biti 0-7) jābūt iestatītam uz 3 Koda lauku (8. –15. biti) izmanto, lai norādītu kļūdas tipu, un tas var būt: Next-hop MTU laukā (48. –63. biti) ir next-hop tīkla MTU, ja rodas 4. koda kļūda. (Next-hop - nākamais tuvākais maršrutētājs, kuram var tikt izmantota pakete) Ir iekļauta IP galvene un papildu dati, kas ļauj klientam saskaņot atbildi ar pieprasījumu, kas izraisīja mērķa nesasniedzamo atbildi. Ping «IANA ICMP Parameters». Iana.org. 2012-09-21. Skatīts: 2013-01-07. Kurose, J.F, Ross, K.W. Computer Networking: A Top-Down Approach,. World student series. Addison-Wesley, 2006. ISBN 9780321418494. Veidne:Cite rfc Veidne:Cite IETF Veidne:IETF RFC «When Are ICMP Redirects Sent?». Cisco Systems. 2008-06-28. Skatīts: 2013-08-15. «Cisco IOS IP Command Reference, Volume 1 of 4: Addressing and Services, Release 12.3 - IP Addressing and Services Commands: ip mask-reply through ip web-cache». Cisco Systems. Arhivēts no oriģināla, laiks: 2013-01-02. Skatīts: 2013-01-07. RFC 792, Internet Control Message Protocol RFC 950, Internet Standard Subnetting Procedure RFC 1016, Something a Host Could Do with Source Quench: The Source Quench Introduced Delay (SQuID) RFC 1122, Requirements for Internet Hosts – Communication Layers RFC 1716, Towards Requirements for IP Routers RFC 1812, Requirements for IP Version 4 Routers IANA ICMP Parameters IANA protocol numbers Explanation of ICMP Redirect Behavior